<!DOCTYPE html>
<html lang="en">
<head>
<title>Effective Task Managment</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="jqgrid/css/jquery-ui.css" />
<link rel="stylesheet" type="text/css" media="screen" href="jqgrid/css/jquery.comiseo.daterangepicker.css" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script type="text/ecmascript" src="jqgrid/js/jquery.jqGrid.js"></script>
<script type="text/ecmascript" src="jqgrid/js/grid.locale-en.js"></script>

<link rel="stylesheet" href="jqgrid/css/github.css">
<script src="jqgrid/js/highlight.pack.js" type="text/javascript"></script>
<script type="text/javascript"></script>
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">

 <script type="text/javascript">
 $(".modal-wide").on("show.bs.modal", function() {
	  var height = $(window).height() - 200;
	  $(this).find(".modal-body").css("max-height", height);
	});
 
 </script>
  
<link rel="stylesheet" type="text/css" media="screen" href="jqgrid/css/ui.jqgrid.css" />	
<script src="jqgrid/js/jquery.tableCheckbox.js" type="text/javascript"></script>
<script type="text/ecmascript" src="jqgrid/js/jquery-progresspiesvg-min.js"></script>
 
</head>
<body>


	<div id="exTab3" class="container">
		<h3>FRPA</h3>
		<!-- <ul class="nav nav-pills">

			<li class="active"><a href="#1b" data-toggle="tab">Task</a></li>
			<li><a href="#2b" data-toggle="tab">Resources</a></li>
			<li><a href="#3b" data-toggle="tab">Dashboard</a></li>
		</ul> -->

		<div class="tab-content clearfix">
			<div class="tab-pane active" id="1b">
				<br />

				<!-- add task -->
				<div class="container">
					<!-- Trigger the modal with a button -->
					<button type="button" class="btn btn-info btn-md"
						data-toggle="modal" data-target="#myModal">Add Task</button>

					<!-- Modal -->
					<div class="modal fade modal-wide" id="myModal" role="dialog">
						<div class="modal-dialog ">

							<!-- Modal content-->
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">ADD NEW TASK</h4>
								</div>
								<div class="modal-body">


									<div class="col-md-12 col-sm-12 col-xs-12">
										<div class="panel panel-primary">
											<div class="panel-heading">Task Form</div>
											<div class="panel-body">

												<!-- Left div -->
												<div class="container">
													<form class="form-horizontal" role="form">


														<div class="row">
															<div class="form-group col-md-3 col-sm-3 col-xs-3">
																<label class="control-label" for="title">Title:</label>
																<input type="text" class="form-control" id="title"
																	placeholder="Enter title">
															</div>
															<div class="col-md-1 col-sm-1 col-xs-1"></div>
															<div class="form-group col-md-3 col-sm-3 col-xs-3">
																<label class="control-label" for="sdate">
																	Start Date:</label> <input type="text" class="form-control"
																	id="sdate" placeholder="Enter start date">
															</div>
															<div class="col-md-1 col-sm-1 col-xs-1"></div>
															<div class="form-group col-md-3 col-sm-3 col-xs-3">
																<label class="control-label" for="edate"> End
																	Date:</label> <input type="text" class="form-control"
																	id="edate" placeholder="Enter end date">
															</div>
															<div class="col-md-1 col-sm-1 col-xs-1"></div>
														</div>
														<div class="row">
															<div class="form-group col-md-8 col-sm-8 col-xs-8">
																<label class="control-label" for="description">Description:</label>
																<input type="text" class="form-control" id="description"
																	placeholder="Enter description">
															</div>
															<div class="form-group col-md-3 col-sm-3 col-xs-3">
																<label class="control-label" for="description">Complexity Level:</label>
																	<select name="clevel" id="clevel" class="form-control">
																	  <option value="1"> Level 1</option>
																	  <option value="2"> Level 2</option>
																	  <option value="3"> Level 3</option>
																	  <option value="4"> Level 4</option>
																	  <option value="5"> Level 5</option>
																	</select>
															</div>
															<div class="col-md-1 col-sm-1 col-xs-1"></div>
														</div>
														<div class="row">
															<div class="form-group col-md-12 col-sm-12  col-xs-12">
																<label class="control-label">Skills:</label> <input
																	type='button' class="btn btn-primary btn-sm"
																	value='Add Skill' id='addButton'> <input
																	type='button' class="btn btn-default btn-sm"
																	value='Remove Skill' id='removeButton'>
																    <input type='button' class="btn btn-default btn-sm" value='Get Skill' id='getButtonValue'> 
															</div>
														</div>

														<div class="form-group col-md-12 col-sm-12  col-xs-12"
															id='TextBoxesGroup'>
															<!-- List of skills -->
														</div>
														<div class="row">
															<div class="form-group col-md-12 col-sm-12  col-xs-12">
																<label class="control-label" for="getRButton">Allocate
																	Resources:</label> <input type='button'
																	class="btn btn-primary btn-sm" value='Get Resource'
																	id='getRButton'>
															</div>
														</div>

														<div class="form-group col-md-11 col-sm-11  col-xs-11" id="resoucecontainer">

															<div class="panel panel-default">
																<div class="panel-body" >


																	<!-- <div class="row">
																		<div class="col-md-4 col-sm-4 col-xs-4"></div>
																		<div class="form-group col-md-7 col-sm-7 col-xs-7">
																			<label for="fromdate">From</label> <input type="text"
																				id="fromdate" name="fromdate"> <label
																				for="to">to</label> <input type="text" id="to"
																				name="to">
																		</div>

																	</div>
																	<HR>
 -->
																	<div class="row">
																		<div class="col-md-1 col-sm-1 col-xs-1"></div>
																		<div class="form-group col-md-3 col-sm-3 col-xs-3">
																			<label class="control-label" for="dh">DH:</label> <select
																				class="form-control" id="dh">
																				
																			</select>
																		</div>
																		<div class="col-md-1 col-sm-1 col-xs-1"></div>
																		<div class="form-group col-md-3 col-sm-3 col-xs-3">
																			<label class="control-label" for="spm">SPM:</label> <select
																				class="form-control" id="spm">
																				
																			</select>
																		</div>
																		<div class="col-md-1 col-sm-1 col-xs-1"></div>
																		<div class="form-group col-md-3 col-sm-4 col-xs-3">
																			<label class="control-label" for="manager">Manager:</label>
																			<select class="form-control" id="manager">
																				
																			</select>
																		</div>
																	</div>




																	<div class="col-md-12 col-sm-12  col-xs-12" id="resourcetable">
																		
																	</div>





																</div>
															</div>

														</div>
														<div class="row">
															<div class="form-group col-md-10 col-sm-10  col-xs-10"></div>
															<div class="form-group col-md-2 col-sm-2  col-xs-2">
																
																 <input type='button'
																	class="btn btn-primary btn-sm" value='Create Task'
																	id='submitButton'>
															</div>
														</div>
													</form>
												</div>
												<!-- /	Left div -->
											</div>
										</div>
									</div>




								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default"
										data-dismiss="modal">Close</button>
								</div>
							</div>

						</div>
					</div>
					<!--\ Modal -->
				</div>
				<!-- \add task -->
				<br />


				<table id="Task"></table>
				<div id="pager"></div>
				<br />
				<table id="Task_d"></table>
				<div id="pager_d"></div>

			</div>
			<div class="tab-pane" id="2b">
				<h3>resourcestab</h3>
			</div>
			<div class="tab-pane" id="3b">
				<h3>tastresourcestab</h3>
			</div>

		</div>
	</div>

	<script type="text/javascript">

$(document).ready(function(){

	hljs.initHighlightingOnLoad();
	$(".pp.dyncolor").progressPie({mode:$.fn.progressPie.Mode.COLOR, valueData:"val", size:50, strokeWidth: 0});
	$('table').tableCheckbox({ /* options */});
	
    var counter = 1;
    var ctr=1;
	
    $("#addButton").click(function () {
			
		if(counter>10){
	        alert("Only 10 textboxes allow");
	        return false;
	    }   
		
		var newTextBoxDiv = $(document.createElement('div')).attr("id", 'TextBoxDiv' + counter);
            newTextBoxDiv.after().html('<div class="col-md-3 col-sm-3 col-xs-3"><label for="textbox' + counter + '" >Skill #'+ counter + ' : </label>' +
			'<input type="text" name="textbox' + counter +'" id="textbox' + counter + '" value="" class="form-control" placeholder="Enter skills"></div>'+
			'<div class="col-md-3 col-sm-3 col-xs-3"><label for=""textboxhour' + counter +'"">Hour(s)</label><input type="text" name="textboxhour' + counter +'" id="textboxhour' + counter + '" value="" class="form-control" placeholder="Enter Hour"></div>'+
			'<div class="col-md-4 col-sm-4 col-xs-4 "><label for=""textboxcmpx' + counter +'"">Complexcity Level</label><input type="text" name="textboxcmpx' + counter +'" id="textboxcmpx' + counter + '" value="" class="form-control" placeholder="Enter skill level"></div>');
        
		newTextBoxDiv.appendTo("#TextBoxesGroup");
			
	    counter++;
    });

    $("#removeButton").click(function () {
	    if(counter==1){
	        alert("No more textbox to remove");
	        return false;
	    }   
        counter--;
		
        $("#TextBoxDiv" + counter).remove();
	});
	
  // $("#resoucecontainer").hide();
/* 	$("#getButtonValue").click(function () {
	
		var msg = '';
		for(i=1; i<counter; i++){
			msg += $('#textbox' + i).val()+ ":" + $('#textboxhour' + i).val()+":" + $('#textboxcmpx' + i).val()+",";
		}
	   	alert(msg);
	}); */
	
	submitButton
	
	/* Start submitButton */

	$("#submitButton").click(function() { 

		var title = $("#title").val();
		var sdate = $("#sdate").val();
		var edate = $("#edate").val();
		var description = $("#description").val();
		var clevel = $("#clevel").val();
		
		var rrecord = '';
		
		for(i=0; i<ctr; i++){
			rrecord +=  $('#rtitle' + i).val()+ ":" + $('#redId' + i).prop('checked')+ ":" + $('#assignedhour' + i).val()
			+":" + $('#rsdate' + i).val()+":" + $('#redate' + i).val()+",";
		}
		
		var dataString = 'title='+ title + '&sdate=' + sdate + '&edate=' + edate 
		+ '&description=' + description+ '&clevel=' + clevel+ '&rrecord=' + rrecord;
		
		$.ajax({ 
	            type: "POST", 
	            url: "servercall?formate=JSON&type=tasksubmit", 
	            data: dataString,
				dataType: "json",			
	            success: function(response) { 
	            	alert("Task successfully created!")
	            } 
	        }); 
       
		 $('#myModal').modal('toggle');
        return false;    
     }); 

	
	/* End submitButton */
	
	
	/* Start GetRButton */
    $("#getRButton").click(function() { 
    	//$("#resoucecontainer").show();

		var title = $("#title").val();
		var sdate = $("#sdate").val();
		var edate = $("#edate").val();
		
		var skill = '';
		
		for(i=1; i<counter; i++){
			
			skill += $('#textbox' + i).val()+ ":" + $('#textboxhour' + i).val()+":" + $('#textboxcmpx' + i).val()+",";
		}
		
		var dataString = 'title='+ title + '&sdate=' + sdate + '&edate=' + edate + '&skill=' + skill;

        $.ajax({ 
            type: "GET", 
            url: "servercall?formate=JSON&type=suggestedresourcelist", 
            data: dataString,
			dataType: "json",			
            success: function(response) { 
               
            	$("#dh").append('<option value=1>'+response.dh+'</option>');
            	$("#spm").append('<option value=1>'+response.spm+'</option>');
            	$("#manager").append('<option value=1>'+response.manager+'</option>');
            	
            	var tableStr="<table>";
                var tableHeader="";
               
                 tableHeader+=("<th align=\"center\">Selected</th>");
                 tableHeader+=("<th align=\"center\">Name</th>");
                 tableHeader+=("<th align=\"center\">Assignment Hour(s)</th>");
                 tableHeader+=("<th align=\"center\">Skill</th>");
                 tableHeader+=("<th align=\"center\">Start  Date</th>");
                 tableHeader+=("<th align=\"center\">End Date</th>");
                 tableHeader+=("<th align=\"center\">Availability</th>");
                 tableHeader+=("<th align=\"center\">Occupied</th>");
                 tableHeader+=("<th align=\"center\">Ratings</th>");
                
                tableHeader="<thead><tr>"+tableHeader+"</tr></thead>"; 
                
                var tableBody="";
                var tableRow="";
               	ctr=response.rows.length;
                for(i=0;i<response.rows.length;i++){
                	
                    		if(response.rows[i].flag){
                          		tableRow+="<tr><td><input type=\"checkbox\" id=\"redId"+i+"\" checked></td>";
                			}else{
                				tableRow+="<td><input type=\"checkbox\" id=\"resId\""+i+" ></td>";
                			}
                
                			tableRow+="<td><input type=\"text\" class=\"form-control\" id=\"rtitle"+i+"\" placeholder=\"Enter title\" value=\""+response.rows[i].name+"\"></td>";
                        	
                			tableRow+="<td><input type=\"text\" class=\"form-control\" id=\"assignedhour"+i+"\" placeholder=\"Hour\" value=\""+response.rows[i].assignedhour+"\"></td>";
                			
                			tableRow+="<td><input type=\"text\" class=\"form-control\" id=\"skill"+i+"\" placeholder=\"Hour\" value=\""+response.rows[i].skills+"\"></td>";
                	         
                			tableRow+="<td><input type=\"text\" class=\"form-control\" id=\"rsdate"+i+"\" placeholder=\"Enter start date\" value=\"\"></td>";

                          	tableRow+="<td><input type=\"text\" class=\"form-control\" id=\"redate"+i+"\" placeholder=\"Enter end date\" value=\"\"></td>";
                          	
                        	tableRow+="<td><div class=\"progress\"><div class=\"progress-bar progress-bar-striped active\" role=\"progressbar\" aria-valuenow=\"40\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: "+response.rows[i].availiblityStatus+"%\">"+response.rows[i].availiblityStatus+"%</div><div class=\"progress-bar progress-bar-warning progress-bar-striped active\" role=\"progressbar\" aria-valuenow=\"40\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: "+(100-response.rows[i].availiblityStatus)+"%\">"+(100-response.rows[i].availiblityStatus)+"%</div></div></td>";
                        	
                			tableRow+="<td align=\"center\"><p><span class=\"pp dyncolor\">"+response.rows[i].occupiedpercentage+"</span> %</p></td>";
                        	
                        	tableRow+="<td align=\"center\">"+response.rows[i].ratings+"</td></tr>";
                   			
                }       
                tableBody=tableHeader+"<tbody>"+tableRow+"</tbody>";
                $('#resourcetable').empty();
                //alert("->"+tableBody)
                $('#resourcetable').append("<div class=\"col-md-12 col-sm-12  col-xs-12\" id=\"resourcetable\"><table class=\"table table-bordered table-striped\">"+tableBody+"</table></div>");
                
				
				
                
				
				
            } 
        }); 
        return false;     
     }); 
	/* End GetRButton */
	
	
});


jQuery("#Task_d").jqGrid({
	height: 100,
   	url:'servercall?formate=JSON&type=taskresource&id=101',
	datatype: "json",
   	colNames:['Name','Ratings','Status','Assigned Hour(s)', 'Start date','End date','Actual end date'],
   	colModel:[
   		{name:'name',index:'name', width:150},
   		{name:'ratings',index:'ratings', width:150,align:"center"},
   		{name:'status',index:'status', width:60,align:"left"},
   		{name:'assignedhour',index:'assignedhour', width:120,align:"center"},
   		{name:'sdate',index:'sdate', width:80,align:"center"},
   		{name:'edate',index:'edate', width:80,align:"center"},
   		{name:'aedate',index:'aedate', width:100,align:"center"},
   	],
   	rowNum:5,
   	rowList:[5,10,20],
   	pager: '#pager_d',
   	sortname: 'item',
    viewrecords: true,
    sortorder: "asc",
	multiselect: false,
	caption:"Resource allocation detail"
}).navGrid('#pager_d',{add:false,edit:false,del:false});




jQuery("#Task").jqGrid({
   	url:'servercall?type=tasklist&formate=JSON',
	datatype: "json",
   	colNames:['Task Id','Title','Status','Start Date','End Date','Actual End Date','Skills','Complexity Level', 'Description'],
   	colModel:[
   		{name:'id',index:'id', width
		: 55,
								align : "center"
							}, {
								name : 'title',
								index : 'title',
								width : 150
							}, {
								name : 'status',
								index : 'status',
								width : 80
							}, {
								name : 'sdate',
								index : 'sdate',
								width : 80,
								align : "center"
							}, {
								name : 'edate',
								index : 'edate',
								width : 80,
								align : "center"
							}, {
								name : 'aedate',
								index : 'aedate',
								width : 100,
								align : "center"
							}, {
								name : 'skills',
								index : 'skills',
								width : 150
							}, {
								name : 'clevel',
								index : 'clevel',
								width : 120,
								align : "center"
							}, {
								name : 'desc',
								index : 'desc',
								width : 200
							} ],
							rowNum : 10,
							rowList : [ 10, 20, 30 ],
							pager : '#pager',
							sortname : 'id',
							viewrecords : true,
							sortorder : "desc",
							multiselect : false,
							caption : "Backlog",
							editurl : "someurl.jsp",
							height : 110,
							onSelectRow : function(ids) {

								jQuery("#Task_d").jqGrid('setCaption',
										"Assignment Detail: " + ids).trigger(
										'reloadGrid');
								if (ids == null) {
									ids = 0;
									if (jQuery("#Task_d").jqGrid(
											'getGridParam', 'records') > 0) {
										jQuery("#Task_d")
												.jqGrid(
														'setGridParam',
														{
															url : "servercall?formate=JSON&type=taskresource&id="
																	+ ids,
															page : 1
														});
										jQuery("#Task_d").jqGrid('setCaption',
												"Assignment Detail: " + ids)
												.trigger('reloadGrid');
									}
								} else {

									jQuery("#Task_d")
											.jqGrid(
													'setGridParam',
													{
														url : "servercall?formate=JSON&type=taskresource&id="
																+ ids,
														page : 1
													});
									jQuery("#Task_d").jqGrid('setCaption',
											"Assignment Detail: " + ids)
											.trigger('reloadGrid');
								}
							}
						}).navGrid('#pager',{add:false,edit:false,del:false});

	</script>
	
</body>
</html>