/**
 * @license 
 * Copyright (c) 2015, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";$.fn.progressPie=function(e){function t(e){return.02*Math.PI*e}function r(e,t){var r=eval,n=r(e);if("function"==typeof n)return n(t);throw"The value of the attribute "+a.colorFunctionAttr+" is NOT a function: "+e}function n(e,n,o,i,a,f,d,p,c){var v=d===l.GREY?l.GREY.color:d===l.GREEN?s.colorByPercent(100):d===l.RED?s.colorByPercent(0):d===l.COLOR||void 0===p?s.colorByPercent(f):d===l.USER_COLOR_CONST?p:d===l.USER_COLOR_FUNC?p(f):d===l.DATA_ATTR_FUNC?r(p,f):"black",A=document.createElementNS(u,"circle");A.setAttribute("cx",0),A.setAttribute("cy",0);var h=i&&100===f?i:o;if(A.setAttribute("r",n-h/2),A.style.stroke=v,A.style.strokeWidth=h,A.style.fill=i||100!==f?"none":v,e.appendChild(A),f>0&&100>f){var y=document.createElementNS(u,"path"),g=t(f),R=Math.sin(g)*n,b=Math.cos(g-Math.PI)*n,m=f>50?"1":"0",E="1",M=i?n-i:0,C=-M,O="M0,"+C,S;if(i&&a?(S=i/2,O+="a"+S+","+S+" 0 0,"+E+" 0,-"+i):O+=" v-"+(i?i:n),O+=" A"+n+","+n+" 0 "+m+","+E+" "+R+","+b,i){var N=Math.sin(g)*M,_=Math.cos(g-Math.PI)*M,P="0";O+=a?" A"+S+","+S+" 0 0,"+E+" "+N+","+_:" L"+N+","+_,O+=" A"+M+","+M+" 0 "+m+","+P+" 0,-"+M}else O+=" Z";if(y.setAttribute("d",O),y.style.fill=v,y.style.stroke="none",c){var T=c.clockwise===!1,w="string"==typeof c?c:"string"==typeof c.duration?c.duration:"1s",D=document.createElementNS(u,"animateTransform");D.setAttribute("attributeName","transform"),D.setAttribute("attributeType","XML"),D.setAttribute("type","rotate"),D.setAttribute("from","0"),D.setAttribute("to",T?"-360":"360"),D.setAttribute("dur",w),D.setAttribute("repeatDur","indefinite"),y.appendChild(D)}e.appendChild(y)}}function o(e,t){var r;if("string"==typeof t.valueData){if(r=e.data(t.valueData),"undefined"!=typeof t.valueAttr||"undefined"!=typeof t.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof t.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof t.valueAttr){if(r=e.attr(t.valueAttr),"undefined"!=typeof t.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof t.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof t.valueSelector&&(r=$(t.valueSelector,e).text())}}return"undefined"==typeof r&&(r=e.text()),Math.max(0,Math.min(100,t.valueAdapter(r)))}function i(e,t){var r=t.mode,n=t.color,o=typeof n;if("undefined"!==o&&"string"!==o&&"function"!==o)throw"option 'color' has to be either a function or a string, but is of type '"+o+"'!";return"function"===o?r=l.USER_COLOR_FUNC:("undefined"===o&&"string"==typeof t.colorAttr&&(n=e.attr(t.colorAttr)),"string"==typeof n?r=l.USER_COLOR_CONST:"string"==typeof t.colorFunctionAttr&&(n=e.attr(t.colorFunctionAttr),"string"==typeof n&&(r=l.DATA_ATTR_FUNC))),{mode:r,color:n}}var a=$.extend({},$.fn.progressPie.defaults,e),u="http://www.w3.org/2000/svg",s=$.fn.progressPie,l=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},s.Mode);return $(this).each(function(){var e=$(this),t=$("svg",e);if(!t.length||a.update){t.length&&a.update&&(t.remove(),a.separator="");var r=o(e,a),s=i(e,a),l=Math.ceil("number"==typeof a.size?a.size:e.height());0===l&&(l=20);var f=Math.floor(l/2),d=f,p=document.createElementNS(u,"svg");p.setAttribute("width",l),p.setAttribute("height",l),p.setAttribute("viewBox","-"+d+" -"+d+" "+l+" "+l),p.style.verticalAlign=a.verticalAlign,a.prepend?e.prepend(p,a.separator):e.append(a.separator,p),n(p,d,a.strokeWidth,a.ringWidth,a.ringEndsRounded,r,s.mode,s.color,a.rotation),"object"==typeof a.inner&&("undefined"==typeof a.inner.valueAdapter&&(a.inner.valueAdapter=$.fn.progressPie.defaults.valueAdapter),r=o(e,a.inner),s=i(e,a.inner),d=Math.floor("number"==typeof a.inner.size?a.inner.size/2:.6*d),n(p,d,0,a.inner.ringWidth,a.inner.ringEndsRounded,r,s.mode,s.color))}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{}},$.fn.progressPie.colorByPercent=function(e){var t=$.fn.progressPie.Mode.GREEN.value,r=$.fn.progressPie.Mode.RED.value,n=e>50?t:Math.floor(t*e/50),o=50>e?r:Math.floor(r*(100-e)/50);return"rgb("+o+","+n+",0)"},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,strokeWidth:2,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(e){return"string"==typeof e?parseInt(e):"number"==typeof e?e:0},ringEndsRounded:!1}}(jQuery);